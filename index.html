<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>üéµ Circle of Fifths Note Guessing Game üéµ</title>
  <style>
    body {
      background-color: #282C34;
      color: #FFFFFF;
      font-family: 'Segoe UI', sans-serif;
      text-align: center;
      margin: 0;
      padding: 0;
      user-select: none;
      overflow-x: hidden;
    }
    h1 {
      color: #61DAFB;
      font-size: 32px;
      margin: 30px 0 10px;
    }
    .label {
      font-size: 24px;
      margin: 10px 0;
    }
    .score {
      color: #FFD700;
    }
    .timer {
      color: #21A1C4;
      font-size: 20px;
    }
    .feedback {
      font-size: 24px;
      margin: 10px 0;
    }
    button {
      background-color: #61DAFB;
      color: #282C34;
      border: none;
      padding: 15px 30px;
      font-size: 28px;
      margin: 20px 0;
      border-radius: 8px;
      cursor: pointer;
    }
    button:active {
      background-color: #21A1C4;
    }
    .progress {
      width: 80%;
      height: 20px;
      background-color: #444;
      margin: 20px auto;
      border-radius: 10px;
      overflow: hidden;
    }
    .progress-bar {
      height: 100%;
      width: 0%;
      background-color: #61DAFB;
      transition: width 0.3s ease;
    }

    .note-buttons {
      position: fixed;
      bottom: 0;
      left: 0;
      width: 100%;
      display: flex;
      flex-wrap: nowrap;
      margin: 0;
      padding: 0;
      z-index: 999;
    }
    .note-btn {
      background-color: #FFFFFF;
      color: #282C34;
      border: 0.5px solid #888;
      font-size: 22px;
      flex: 1 1 0;
      padding: 150px 0;
      border-radius: 0;
      cursor: pointer;
      margin: 0;
    }
    .note-btn:active {
      background-color: #ddd;
    }

    .note-btn2 {
      position: absolute;
      background-color: #000000;
      color: #FFFFFF;
      border: 0.5px solid #333;
      font-size: 18px;
            padding: 100px 0;
      border-radius: 0;
      cursor: pointer;
      z-index: 1000;
            width: 80px;
    }
    .note-btn2:active {
      background-color: #444;
    }

    /* ‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏õ‡∏∏‡πà‡∏°‡∏•‡∏≠‡∏¢ */
    #btnCsharp { left: 9%; bottom: 87px; }
    #btnEb     { left: 23.4%; bottom: 87px; }
    #btnFsharp { left: 51.8%; bottom: 87px; }
    #btnGsharp { left: 66.2%; bottom: 87px; }
    #btnBb     { left: 80.5%; bottom: 87px; }

  </style>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
</head>
<body oncontextmenu="return false;">

<h1 id="question">Press ‚ñ∂ Start or Space to Begin</h1>
<div class="feedback" id="feedback"></div>
<div class="label score" id="score">Score: 0</div>
<div class="timer" id="timer"></div>
<button id="startButton" onclick="startGame()">‚ñ∂ Start</button>
<div class="progress"><div class="progress-bar" id="progressBar"></div></div>

<div class="note-buttons">
  <button class="note-btn" onclick="manualAnswer('C')">1</button>
  <button class="note-btn" onclick="manualAnswer('D')">2</button>
  <button class="note-btn" onclick="manualAnswer('E')">3</button>
  <button class="note-btn" onclick="manualAnswer('F')">4</button>
  <button class="note-btn" onclick="manualAnswer('G')">5</button>
  <button class="note-btn" onclick="manualAnswer('A')">6</button>
  <button class="note-btn" onclick="manualAnswer('B')">7</button>
</div>

<!-- ‡∏õ‡∏∏‡πà‡∏°‡πÇ‡∏ô‡πâ‡∏ï‡∏î‡∏≥ -->
<button id="btnCsharp" class="note-btn2" onclick="manualAnswer('C#')">8</button>
<button id="btnEb" class="note-btn2" onclick="manualAnswer('Eb')">9</button>
<button id="btnFsharp" class="note-btn2" onclick="manualAnswer('F#')">10</button>
<button id="btnGsharp" class="note-btn2" onclick="manualAnswer('G#')">11</button>
<button id="btnBb" class="note-btn2" onclick="manualAnswer('Bb')">12</button>

<script>
const keyToNote = {
  'v': 'C', 'g': 'C#', 'b': 'D', 'h': 'Eb', 'n': 'E', 'm': 'F',
  'k': 'F#', ',': 'G', 'l': 'G#', '.': 'A', ';': 'Bb', '/': 'B'
};

const positionToNote = {
  1: 'G', 2: 'D', 3: 'A', 4: 'E', 5: 'B', 6: 'F#',
  7: 'Db', 8: 'Ab', 9: 'Eb', 10: 'Bb', 11: 'F', 12: 'C'
};

const noteSounds = {};
const notes = ['C', 'C#', 'D', 'Eb', 'E', 'F', 'F#', 'G', 'G#', 'A', 'Bb', 'B'];

notes.forEach(note => {
  noteSounds[note] = new Audio(`sounds/${note}4.wav`);
});

let gameStarted = false;
let questionList = [];
let currentIndex = 0;
let score = 0;
let startTime = 0;
let maxRounds = 100;
let currentSound = null;
let timeLimit = 5;
let countdownTimer = null;

function startGame() {
  gameStarted = true;
  score = 0;
  currentIndex = 0;
  questionList = generateQuestions(maxRounds);
  document.getElementById('startButton').style.display = 'none';
  nextQuestion();
}

function generateQuestions(total) {
  let numbers = [];
  while (numbers.length < total) {
    let batch = [...Array(12).keys()].map(x => x + 1);
    batch.sort(() => Math.random() - 0.5);
    numbers = numbers.concat(batch);
  }
  return numbers.slice(0, total);
}

function nextQuestion() {
  if (currentIndex >= maxRounds) {
    showResult();
    return;
  }
  if (currentSound) currentSound.pause();
  document.getElementById('question').innerText = formatRoundDisplay();
  document.getElementById('score').innerText = `Score: ${score}`;
  startTime = new Date().getTime();

  const noteName = positionToNote[questionList[currentIndex]];
  if (noteSounds[noteName]) {
    currentSound = noteSounds[noteName];
    currentSound.currentTime = 0;
    currentSound.play();
  }

  startCountdown();
  updateProgress();
}

function formatRoundDisplay() {
  let displayNumbers = [];
  for (let i = 0; i < 5; i++) {
    if (currentIndex + i < maxRounds) {
      displayNumbers.push(questionList[currentIndex + i]);
    }
  }
  return `Round ${currentIndex + 1}:   ${displayNumbers.join(' - ')}`;
}

function checkAnswer(key) {
  if (!gameStarted || currentIndex >= maxRounds) return;
  let pressedKey = key.toLowerCase();
  let userNote = keyToNote[pressedKey];
  if (!userNote) return;
  let correctNote = positionToNote[questionList[currentIndex]];
  if (currentSound) currentSound.pause();
  stopCountdown();

  if (userNote === correctNote) {
    let elapsedTime = (new Date().getTime() - startTime) / 1000;
    let baseScore = 100;
    let bonusScore = calculateBonus(elapsedTime);
    let totalScore = baseScore + bonusScore;
    document.getElementById('feedback').innerText = `‚úÖ Correct! +${totalScore} (Total: ${score + totalScore})`;
    document.getElementById('feedback').style.color = '#32CD32';
    score += totalScore;
  } else {
    document.getElementById('feedback').innerText = `‚ùå Wrong! ${correctNote} (Total: ${score})`;
    document.getElementById('feedback').style.color = '#FF5555';
  }
  currentIndex++;
  nextQuestion();
}

function manualAnswer(userNote) {
  if (!gameStarted || currentIndex >= maxRounds) return;
  let correctNote = positionToNote[questionList[currentIndex]];
  if (currentSound) currentSound.pause();
  stopCountdown();

  if (userNote === correctNote) {
    let elapsedTime = (new Date().getTime() - startTime) / 1000;
    let baseScore = 100;
    let bonusScore = calculateBonus(elapsedTime);
    let totalScore = baseScore + bonusScore;
    document.getElementById('feedback').innerText = `‚úÖ Correct! +${totalScore} (Total: ${score + totalScore})`;
    document.getElementById('feedback').style.color = '#32CD32';
    score += totalScore;
  } else {
    document.getElementById('feedback').innerText = `‚ùå Wrong! ${correctNote} (Total: ${score})`;
    document.getElementById('feedback').style.color = '#FF5555';
  }
  currentIndex++;
  nextQuestion();
}

function calculateBonus(elapsedTime) {
  if (elapsedTime <= 0.3) return 100;
  else if (elapsedTime <= 0.7) return Math.floor(30 + (70 * Math.exp(-7 * (elapsedTime - 0.3))));
  else if (elapsedTime <= 1.0) return Math.floor(30 * Math.exp(-10 * (elapsedTime - 0.7)));
  else return 0;
}

function showResult() {
  gameStarted = false;
  stopCountdown();
  document.getElementById('question').innerHTML = `üéâ Game Over!<br>Your Score: ${score}`;
  document.getElementById('feedback').innerText = '';
  document.getElementById('startButton').innerText = "‚ñ∂ Restart";
  document.getElementById('startButton').style.display = 'inline-block';
  document.getElementById('progressBar').style.width = '0%';
  document.getElementById('timer').innerText = '';
}

function updateProgress() {
  let percent = (currentIndex / maxRounds) * 100;
  document.getElementById('progressBar').style.width = `${percent}%`;
}

function startCountdown() {
  let timeLeft = timeLimit;
  document.getElementById('timer').innerText = `‚è≥ ${timeLeft.toFixed(1)}s`;
  countdownTimer = setInterval(() => {
    timeLeft -= 0.1;
    if (timeLeft <= 0) {
      clearInterval(countdownTimer);
      document.getElementById('feedback').innerText = `‚ùå Timeout! ${positionToNote[questionList[currentIndex]]} (Total: ${score})`;
      document.getElementById('feedback').style.color = '#FF5555';
      currentIndex++;
      nextQuestion();
    } else {
      document.getElementById('timer').innerText = `‚è≥ ${timeLeft.toFixed(1)}s`;
    }
  }, 100);
}

function stopCountdown() {
  if (countdownTimer) clearInterval(countdownTimer);
}

document.addEventListener('keydown', e => {
  if (e.key === ' ' && !gameStarted) startGame();
  else if (e.key === 'Escape') window.close();
  else if (gameStarted) checkAnswer(e.key);
});
</script>

</body>
</html>
